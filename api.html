<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>Naver Maps JS API 테스트3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    #controls { padding: 10px; background: #fafafa; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    #controls input { padding: 6px; margin-right: 6px; width: 150px; }
    #controls button { padding: 6px 12px; }
    #map { width:100%; height:calc(100vh - 60px); }
  </style>

  <!-- Naver Maps JS API + Places 서비스 -->
 <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=1wb8dgny44&submodules=maps,geocoder,service" defer></script>
</head>
<body onload="initMap()">

  <div id="controls">
    <input id="titleInput" placeholder="업체명 (예: 연산정)" />
    <input id="locaInput"  placeholder="위치   (예: 연산동)" />
    <button id="searchBtn">검색</button>
  </div>

  <div id="map"></div>

  <script>
    let map, marker, infoWindow;

    function initMap() {
      map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(35.1796, 129.0756), // 기본 중심: 부산
        zoom: 13
      });
      marker = new naver.maps.Marker({ map: map });
      infoWindow = new naver.maps.InfoWindow();
    }

    // 검색 버튼 이벤트 바인딩
    document.getElementById('searchBtn').addEventListener('click', () => {
      const title = document.getElementById('titleInput').value.trim();
      const loca  = document.getElementById('locaInput').value.trim();
      if (!title || !loca) {
        return alert('업체명과 위치를 모두 입력해주세요.');
      }
      const query = `${title} ${loca}`;
      searchPlace(query);
    });

    // Places Search 호출
    function searchPlace(query) {
      const service = new naver.maps.Service.Places();
      service.search({ query }, (status, response) => {
        if (status !== naver.maps.Service.Status.OK) {
          return alert('검색 실패: ' + status);
        }
        const item = response.result.items[0];
        const latlng = new naver.maps.LatLng(item.point.y, item.point.x);

        // 지도 이동 및 마커 설정
        map.setCenter(latlng);
        map.setZoom(15);
        marker.setPosition(latlng);

        // 정보창 내용 구성
        const content = `
          <div style="padding:8px;min-width:200px;">
            <strong>${item.title.replace(/<[^>]*>/g, '')}</strong><br/>
            <div>주소: ${item.address}</div>
            <div>전화: ${item.telephone || '정보 없음'}</div>
            <div>카테고리: ${item.category || '정보 없음'}</div>
          </div>
        `;
        infoWindow.setContent(content);
        infoWindow.open(map, marker);
      });
    }
  </script>

</body>
</html>
